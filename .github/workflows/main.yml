name: 自动更新
on:
 workflow_dispatch: null
 schedule:
  - cron: 0 16 * * *
 push:
  branches:
  - main
permissions:
 contents: write
jobs:
 zdgx:
  runs-on: ubuntu-latest
  steps:
   - name: 检出仓库代码
     uses: actions/checkout@v4
   - name: 设置 Node.js 环境
     uses: actions/setup-node@v3
     with:
      node-version: "18"
   - name: 第一次下载 worker.js
     run: |
      curl -fL -o worker.js https://github.com/bia-pain-bache/BPB-Worker-Panel/releases/latest/download/worker.js
   - name: 检查是否与 _worker.js 相同，如果相同则删除并重新下载
     run: |
      if [ -f "_worker.js" ] && cmp -s "worker.js" "_worker.js"; then
      rm -f _worker.js
      curl -fL -o worker.js https://github.com/bia-pain-bache/BPB-Worker-Panel/releases/latest/download/worker.js
      else
      fi
   - name: 重命名为 _worker.js
     run: |
      mv worker.js _worker.js
   - name: 提交
     run: |
      git config --global user.name "github-actions[bot]"
      git config --global user.email "github-actions[bot]@users.noreply.github.com"
      git add _worker.js
      git commit --allow-empty-message -m ""
      git push
